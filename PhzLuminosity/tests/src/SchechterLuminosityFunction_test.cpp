/*
 * SchechterLuminosityFunction_Test.cpp
 *
 *  Created on: Aug 3, 2015
 *      Author: fdubath
 */

#include <memory>
#include <vector>
#include <utility>
#include "ElementsKernel/Real.h"
#include "ElementsKernel/Exception.h"
#include <boost/test/unit_test.hpp>

#include "PhzLuminosity/SchechterLuminosityFunction.h"

using namespace Euclid;

struct SchechterLuminosityFunction_Fixture {
 std::vector<double> phi {0.01,0.5,1.,1.5};
 std::vector<double> mo {0.,0.5,1.,1.5};
 std::vector<double> lo {0.1,0.5,1.,1.5};
 std::vector<double> alpha {-1.5,-1.,-0.5};
 std::vector<double> m {0.,1.,10.};
 std::vector<double> l {0.1,1.,10.};


};


//-----------------------------------------------------------------------------

BOOST_AUTO_TEST_SUITE (SchechterLuminosityFunction_Test)

//---------------------------------------------------------------------------

BOOST_FIXTURE_TEST_CASE(test_functional_form_mag, SchechterLuminosityFunction_Fixture) {
  std::vector<std::vector<std::vector<std::vector<double>>>> result
  { //phi=0.01
    {
      {
        {
          0.00338829486904,
          0.00980347244867,
          0.920941938399
        },
        {
          0.00338829486904,
          0.0061855729429,
          0.00920941938399
        },
        {
          0.00338829486904,
          0.00390283267814,
          9.20941938399e-05
        }
      },
      {
        {
          0.00149956505782,
          0.00616956276777,
          0.731487398761
        },
        {
          0.00188784055793,
          0.00490065790234,
          0.00920888074707
        },
        {
          0.00237665045179,
          0.00389273094055,
          0.000115932939867
        }
      },
      {
        {
          0.00047138663352,
          0.00338829486904,
          0.580987234561
        },
        {
          0.000747097466483,
          0.00338829486904,
          0.00920802712962
        },
        {
          0.00118406968873,
          0.00338829486904,
          0.000145937395137
        }
      },
      {
        {
          8.61624830867e-05,
          0.00149956505782,
          0.461426767304
        },
        {
          0.000171916755467,
          0.00188784055793,
          0.0092066743992
        },
        {
          0.000343019023495,
          0.00237665045179,
          0.000183697304749
        }
      }
    },
    //phi=0.5
    {
      {
        {
          0.169414743452,
          0.490173622434,
          46.0470969199
        },
        {
          0.169414743452,
          0.309278647145,
          0.460470969199
        },
        {
          0.169414743452,
          0.195141633907,
          0.00460470969199
        }
      },
      {
        {
          0.074978252891,
          0.308478138388,
          36.574369938
        },
        {
          0.0943920278964,
          0.245032895117,
          0.460444037354
        },
        {
          0.11883252259,
          0.194636547028,
          0.00579664699333
        }
      },
      {
        {
          0.023569331676,
          0.169414743452,
          29.049361728
        },
        {
          0.0373548733241,
          0.169414743452,
          0.460401356481
        },
        {
          0.0592034844367,
          0.169414743452,
          0.00729686975686
        }
      },
      {
        {
          0.00430812415434,
          0.074978252891,
          23.0713383652
        },
        {
          0.00859583777336,
          0.0943920278964,
          0.46033371996
        },
        {
          0.0171509511748,
          0.11883252259,
          0.00918486523746
        }
      }
    },
    //phi=1.0
    {
      {
        {
          0.338829486904,
          0.980347244867,
          92.0941938399
        },
        {
          0.338829486904,
          0.61855729429,
          0.920941938399
        },
        {
          0.338829486904,
          0.390283267814,
          0.00920941938399
        }
      },
      {
        {
          0.149956505782,
          0.616956276777,
          73.1487398761
        },
        {
          0.188784055793,
          0.490065790234,
          0.920888074707
        },
        {
          0.237665045179,
          0.389273094055,
          0.0115932939867
        }
      },
      {
        {
          0.047138663352,
          0.338829486904,
          58.0987234561
        },
        {
          0.0747097466483,
          0.338829486904,
          0.920802712962
        },
        {
          0.118406968873,
          0.338829486904,
          0.0145937395137
        }
      },
      {
        {
          0.00861624830867,
          0.149956505782,
          46.1426767304
        },
        {
          0.0171916755467,
          0.188784055793,
          0.92066743992
        },
        {
          0.0343019023495,
          0.237665045179,
          0.0183697304749
        }
      }
    },
    //phi=1.5
    {
      {
        {
          0.508244230356,
          1.4705208673,
          138.14129076
        },
        {
          0.508244230356,
          0.927835941435,
          1.3814129076
        },
        {
          0.508244230356,
          0.585424901721,
          0.013814129076
        }
      },
      {
        {
          0.224934758673,
          0.925434415165,
          109.723109814
        },
        {
          0.283176083689,
          0.735098685351,
          1.38133211206
        },
        {
          0.356497567769,
          0.583909641083,
          0.01738994098
        }
      },
      {
        {
          0.070707995028,
          0.508244230356,
          87.1480851841
        },
        {
          0.112064619972,
          0.508244230356,
          1.38120406944
        },
        {
          0.17761045331,
          0.508244230356,
          0.0218906092706
        }
      },
      {
        {
          0.012924372463,
          0.224934758673,
          69.2140150957
        },
        {
          0.0257875133201,
          0.283176083689,
          1.38100115988
        },
        {
          0.0514528535243,
          0.356497567769,
          0.0275545957124
        }
      }
    }

  };





  for (size_t i = 0; i < phi.size(); ++i) {
    for (size_t j = 0; j < mo.size(); ++j) {
      for (size_t k = 0; k < alpha.size(); ++k) {
        for (size_t h = 0; h < m.size(); ++h) {



          auto function = Euclid::PhzLuminosity::SchechterLuminosityFunction {
              phi[i], mo[j], alpha[k], true };

          auto computed = function(m[h]);

          auto error = std::abs(result[i][j][k][h]-computed)/result[i][j][k][h];

          BOOST_CHECK(error<1e-10);


        }
      }
    }
  }
}


BOOST_FIXTURE_TEST_CASE(test_functional_form_flux, SchechterLuminosityFunction_Fixture) {
  std::vector<std::vector<std::vector<std::vector<double>>>> result
  {
  //phi=0.01
    {
      {
        {
          0.0367879441171,
          1.43567183661e-07,
          3.72007597602e-48,
        },
        {
          0.0367879441171,
          4.53999297625e-07,
          3.72007597602e-47,
        },
        {
          0.0367879441171,
          1.43567183661e-06,
          3.72007597602e-46,
        },
      },
      {
        {
          0.183073761915,
          0.000956964965104,
          4.60887961184e-13,
        },
        {
          0.0818730753078,
          0.00135335283237,
          2.06115362244e-12,
        },
        {
          0.036614752383,
          0.00191392993021,
          9.21775922369e-12,
        },
      },
      {
        {
          0.286134715314,
          0.00367879441171,
          1.43567183661e-08,
        },
        {
          0.0904837418036,
          0.00367879441171,
          4.53999297625e-08,
        },
        {
          0.0286134715314,
          0.00367879441171,
          1.43567183661e-07,
        },
      },
      {
        {
          0.362320297329,
          0.0062880498342,
          4.92888951841e-07,
        },
        {
          0.0935506985032,
          0.00513417119033,
          1.27263380134e-06,
        },
        {
          0.0241546864886,
          0.0041920332228,
          3.28592634561e-06,
        },
      },
    },
    //phi=0.5
    {
      {
        {
          1.83939720586,
          7.17835918306e-06,
          1.86003798801e-46,
        },
        {
          1.83939720586,
          2.26999648812e-05,
          1.86003798801e-45,
        },
        {
          1.83939720586,
          7.17835918306e-05,
          1.86003798801e-44,
        },
      },
      {
        {
          9.15368809576,
          0.0478482482552,
          2.30443980592e-11,
        },
        {
          4.09365376539,
          0.0676676416183,
          1.03057681122e-10,
        },
        {
          1.83073761915,
          0.0956964965104,
          4.60887961184e-10,
        },
      },
      {
        {
          14.3067357657,
          0.183939720586,
          7.17835918306e-07,
        },
        {
          4.52418709018,
          0.183939720586,
          2.26999648812e-06,
        },
        {
          1.43067357657,
          0.183939720586,
          7.17835918306e-06,
        },
      },
      {
        {
          18.1160148664,
          0.31440249171,
          2.4644447592e-05,
        },
        {
          4.67753492516,
          0.256708559516,
          6.3631690067e-05,
        },
        {
          1.20773432443,
          0.20960166114,
          0.00016429631728,
        },
      },
    },
    //phi=1.0
    {
      {
        {
          3.67879441171,
          1.43567183661e-05,
          3.72007597602e-46,
        },
        {
          3.67879441171,
          4.53999297625e-05,
          3.72007597602e-45,
        },
        {
          3.67879441171,
          0.000143567183661,
          3.72007597602e-44,
        },
      },
      {
        {
          18.3073761915,
          0.0956964965104,
          4.60887961184e-11,
        },
        {
          8.18730753078,
          0.135335283237,
          2.06115362244e-10,
        },
        {
          3.6614752383,
          0.191392993021,
          9.21775922369e-10,
        },
      },
      {
        {
          28.6134715314,
          0.367879441171,
          1.43567183661e-06,
        },
        {
          9.04837418036,
          0.367879441171,
          4.53999297625e-06,
        },
        {
          2.86134715314,
          0.367879441171,
          1.43567183661e-05,
        },
      },
      {
        {
          36.2320297329,
          0.62880498342,
          4.92888951841e-05,
        },
        {
          9.35506985032,
          0.513417119033,
          0.000127263380134,
        },
        {
          2.41546864886,
          0.41920332228,
          0.000328592634561,
        },
      },
    },
    //phi=1.5
    {
      {
        {
          5.51819161757,
          2.15350775492e-05,
          5.58011396403e-46,
        },
        {
          5.51819161757,
          6.80998946437e-05,
          5.58011396403e-45,
        },
        {
          5.51819161757,
          0.000215350775492,
          5.58011396403e-44,
        },
      },
      {
        {
          27.4610642873,
          0.143544744766,
          6.91331941776e-11,
        },
        {
          12.2809612962,
          0.203002924855,
          3.09173043366e-10,
        },
        {
          5.49221285746,
          0.287089489531,
          1.38266388355e-09,
        },
      },
      {
        {
          42.9202072971,
          0.551819161757,
          2.15350775492e-06,
        },
        {
          13.5725612705,
          0.551819161757,
          6.80998946437e-06,
        },
        {
          4.29202072971,
          0.551819161757,
          2.15350775492e-05,
        },
      },
      {
        {
          54.3480445993,
          0.94320747513,
          7.39333427761e-05,
        },
        {
          14.0326047755,
          0.770125678549,
          0.000190895070201,
        },
        {
          3.62320297329,
          0.62880498342,
          0.000492888951841,
        },
      },
    },
 };


  for (size_t i = 0; i < phi.size(); ++i) {
     for (size_t j = 0; j < lo.size(); ++j) {
       for (size_t k = 0; k < alpha.size(); ++k) {
         for (size_t h = 0; h < l.size(); ++h) {



           auto function = Euclid::PhzLuminosity::SchechterLuminosityFunction {
               phi[i], lo[j], alpha[k], false };

           auto computed = function(l[h]);

           auto error = std::abs(result[i][j][k][h]-computed)/result[i][j][k][h];

           BOOST_CHECK(error<1e-10);


         }
       }
     }
   }

}



//-----------------------------------------------------------------------------

BOOST_AUTO_TEST_SUITE_END ()


